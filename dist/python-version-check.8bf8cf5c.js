import t from"./python-version-check.2d65d83f.js";import i from"./python-version-check.9c038654.js";import s from"./python-version-check.fe290f69.js";import{Writable as e}from"node:stream";import{inherits as r}from"node:util";var h={};let a=Buffer.from("-"),n=Buffer.from("\r\n"),_=function(){};function o(t){if(!(this instanceof o))return new o(t);if(e.call(this,t),!t||!t.headerFirst&&"string"!=typeof t.boundary)throw TypeError("Boundary required");"string"==typeof t.boundary?this.setBoundary(t.boundary):this._bparser=void 0,this._headerFirst=t.headerFirst,this._dashes=0,this._parts=0,this._finished=!1,this._realFinish=!1,this._isPreamble=!0,this._justMatched=!1,this._firstWrite=!0,this._inHeader=!0,this._part=void 0,this._cb=void 0,this._ignoreData=!1,this._partOpts={highWaterMark:t.partHwm},this._pause=!1;let i=this;this._hparser=new s(t),this._hparser.on("header",function(t){i._inHeader=!1,i._part.emit("header",t)})}r(o,e),o.prototype.emit=function(t){if("finish"!==t||this._realFinish)e.prototype.emit.apply(this,arguments);else if(!this._finished){let t=this;process.nextTick(function(){if(t.emit("error",Error("Unexpected end of multipart data")),t._part&&!t._ignoreData){let i=t._isPreamble?"Preamble":"Part";t._part.emit("error",Error(i+" terminated early due to unexpected end of multipart data")),t._part.push(null),process.nextTick(function(){t._realFinish=!0,t.emit("finish"),t._realFinish=!1});return}t._realFinish=!0,t.emit("finish"),t._realFinish=!1})}},o.prototype._write=function(t,s,e){if(!this._hparser&&!this._bparser)return e();if(this._headerFirst&&this._isPreamble){this._part||(this._part=new i(this._partOpts),0!==this.listenerCount("preamble")?this.emit("preamble",this._part):this._ignore());let s=this._hparser.push(t);if(this._inHeader||void 0===s||!(s<t.length))return e();t=t.slice(s)}this._firstWrite&&(this._bparser.push(n),this._firstWrite=!1),this._bparser.push(t),this._pause?this._cb=e:e()},o.prototype.reset=function(){this._part=void 0,this._bparser=void 0,this._hparser=void 0},o.prototype.setBoundary=function(i){let s=this;this._bparser=new t("\r\n--"+i),this._bparser.on("info",function(t,i,e,r){s._oninfo(t,i,e,r)})},o.prototype._ignore=function(){this._part&&!this._ignoreData&&(this._ignoreData=!0,this._part.on("error",_),this._part.resume())},o.prototype._oninfo=function(t,s,e,r){let h,n,_=this,o=0;if(!this._part&&this._justMatched&&s){for(;this._dashes<2&&e+o<r;)if(45===s[e+o])++o,++this._dashes;else{this._dashes&&(h=a),this._dashes=0;break}if(2===this._dashes&&(e+o<r&&0!==this.listenerCount("trailer")&&this.emit("trailer",s.slice(e+o,r)),this.reset(),this._finished=!0,0===_._parts&&(_._realFinish=!0,_.emit("finish"),_._realFinish=!1)),this._dashes)return}this._justMatched&&(this._justMatched=!1),!this._part&&(this._part=new i(this._partOpts),this._part._read=function(t){_._unpause()},this._isPreamble&&0!==this.listenerCount("preamble")?this.emit("preamble",this._part):!0!==this._isPreamble&&0!==this.listenerCount("part")?this.emit("part",this._part):this._ignore(),this._isPreamble||(this._inHeader=!0)),s&&e<r&&!this._ignoreData&&(this._isPreamble||!this._inHeader?(h&&this._part.push(h),this._part.push(s.slice(e,r))||(this._pause=!0)):!this._isPreamble&&this._inHeader&&(h&&this._hparser.push(h),n=this._hparser.push(s.slice(e,r)),!this._inHeader&&void 0!==n&&n<r&&this._oninfo(!1,s,e+n,r))),t&&(this._hparser.reset(),this._isPreamble?this._isPreamble=!1:e!==r&&(++this._parts,this._part.on("end",function(){0==--_._parts&&(_._finished?(_._realFinish=!0,_.emit("finish"),_._realFinish=!1):_._unpause())})),this._part.push(null),this._part=void 0,this._ignoreData=!1,this._justMatched=!0,this._dashes=0)},o.prototype._unpause=function(){if(this._pause&&(this._pause=!1,this._cb)){let t=this._cb;this._cb=void 0,t()}},h=o;export{h as default};
//# sourceMappingURL=python-version-check.8bf8cf5c.js.map
