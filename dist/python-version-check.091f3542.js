let e,s;import t from"./python-version-check.7ed1514e.js";import i from"./python-version-check.dba5a2d4.js";import{connect as n}from"net";import*as o from"assert";import*as r from"tls";var a=globalThis,c={},l=i.InvalidArgumentError,h=$rAjBc$pythonversioncheckdba5a2d4js.ConnectTimeoutError;s=a.FinalizationRegistry&&!process.env.NODE_V8_COVERAGE?class{constructor(e){this._maxCachedSessions=e,this._sessionCache=new Map,this._sessionRegistry=new a.FinalizationRegistry(e=>{if(this._sessionCache.size<this._maxCachedSessions)return;let s=this._sessionCache.get(e);void 0!==s&&void 0===s.deref()&&this._sessionCache.delete(e)})}get(e){let s=this._sessionCache.get(e);return s?s.deref():null}set(e,s){0!==this._maxCachedSessions&&(this._sessionCache.set(e,new WeakRef(s)),this._sessionRegistry.register(s,e))}}:class{constructor(e){this._maxCachedSessions=e,this._sessionCache=new Map}get(e){return this._sessionCache.get(e)}set(e,s){if(0!==this._maxCachedSessions){if(this._sessionCache.size>=this._maxCachedSessions){let{value:e}=this._sessionCache.keys().next();this._sessionCache.delete(e)}this._sessionCache.set(e,s)}}},c=function({allowH2:i,maxCachedSessions:a,socketPath:c,timeout:u,...m}){if(null!=a&&(!Number.isInteger(a)||a<0))throw new l("maxCachedSessions must be a positive integer or zero");let p={path:c,...m},f=new s(null==a?100:a);return u=null==u?1e4:u,i=null!=i&&i,function({hostname:s,host:a,protocol:c,port:l,servername:m,localAddress:d,httpSocket:_},v){let C;if("https:"===c){e||(e=r);let n=(m=m||p.servername||t.getServerName(a)||null)||s,c=f.get(n)||null;o(n),(C=e.connect({highWaterMark:16384,...p,servername:m,session:c,localAddress:d,ALPNProtocols:i?["http/1.1","h2"]:["http/1.1"],socket:_,port:l||443,host:s})).on("session",function(e){f.set(n,e)})}else o(!_,"httpSocket can only be sent on TLS update"),C=n({highWaterMark:65536,...p,localAddress:d,port:l||80,host:s});if(null==p.keepAlive||p.keepAlive){let e=void 0===p.keepAliveInitialDelay?6e4:p.keepAliveInitialDelay;C.setKeepAlive(!0,e)}let g=function(e,s){if(!s)return()=>{};let t=null,i=null,n=setTimeout(()=>{t=setImmediate(()=>{"win32"===process.platform?i=setImmediate(()=>e()):e()})},s);return()=>{clearTimeout(n),clearImmediate(t),clearImmediate(i)}}(()=>{var e;return e=C,void $rAjBc$pythonversioncheck7ed1514ejs.destroy(e,new h)},u);return C.setNoDelay(!0).once("https:"===c?"secureConnect":"connect",function(){if(g(),v){let e=v;v=null,e(null,this)}}).on("error",function(e){if(g(),v){let s=v;v=null,s(e)}}),C}};export{c as default};
//# sourceMappingURL=python-version-check.091f3542.js.map
