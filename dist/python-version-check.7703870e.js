let e;import o from"./python-version-check.64bbae24.js";import t from"./python-version-check.f95b0f32.js";import s from"./python-version-check.92967d43.js";import r from"./python-version-check.13770064.js";import c from"./python-version-check.ff3942ba.js";import n from"./python-version-check.db834fc6.js";import i from"./python-version-check.5597d583.js";import d from"./python-version-check.2f8c5fad.js";import a from"./python-version-check.ebf2a848.js";import{channel as h}from"diagnostics_channel";var p={},l=o.uid,k=$eVhPF$pythonversioncheck64bbae24js.states,f=$eVhPF$pythonversioncheckf95b0f32js1.kReadyState,b=t.kSentClose,u=$eVhPF$pythonversioncheckf95b0f32js.kByteParser,S=$eVhPF$pythonversioncheckf95b0f32js2.kReceivedClose,v=s.fireEvent,H=$eVhPF$pythonversioncheck92967d43js.failWebsocketConnection,_=r.CloseEvent,m=c.makeRequest,w=n.fetching,y=i.Headers,E=d.getGlobalDispatcher,g=a.kHeadersList;let R={};R.open=h("undici:websocket:open"),R.close=h("undici:websocket:close"),R.socketError=h("undici:websocket:socket_error");try{e=$5dced762bb978606$import$4e090cd3d9dfb5ec}catch{}function F(e){this.ws[u].write(e)||this.pause()}function L(){let{ws:e}=this,o=e[b]&&e[S],t=1005,s="",r=e[u].closingInfo;r?(t=r.code??1005,s=r.reason):e[b]||(t=1006),e[f]=k.CLOSED,v("close",e,_,{wasClean:o,code:t,reason:s}),R.close.hasSubscribers&&R.close.publish({websocket:e,code:t,reason:s})}function A(e){let{ws:o}=this;o[f]=k.CLOSING,R.socketError.hasSubscribers&&R.socketError.publish(e),this.destroy()}p={establishWebSocketConnection:function(o,t,s,r,c){o.protocol="ws:"===o.protocol?"http:":"https:";let n=m({urlList:[o],serviceWorkers:"none",referrer:"no-referrer",mode:"websocket",credentials:"include",cache:"no-store",redirect:"error"});c.headers&&(n.headersList=new y(c.headers)[g]);let i=e.randomBytes(16).toString("base64");for(let e of(n.headersList.append("sec-websocket-key",i),n.headersList.append("sec-websocket-version","13"),t))n.headersList.append("sec-websocket-protocol",e);return w({request:n,useParallelQueue:!0,dispatcher:c.dispatcher??E(),processResponse(o){if("error"===o.type||101!==o.status)return void H(s,"Received network error or non-101 status code.");if(0!==t.length&&!o.headersList.get("Sec-WebSocket-Protocol"))return void H(s,"Server did not respond with sent protocols.");if(o.headersList.get("Upgrade")?.toLowerCase()!=="websocket")return void H(s,'Server did not set Upgrade header to "websocket".');if(o.headersList.get("Connection")?.toLowerCase()!=="upgrade")return void H(s,'Server did not set Connection header to "upgrade".');if(o.headersList.get("Sec-WebSocket-Accept")!==e.createHash("sha1").update(i+l).digest("base64"))return void H(s,"Incorrect hash received in Sec-WebSocket-Accept header.");let c=o.headersList.get("Sec-WebSocket-Extensions");if(null!==c&&""!==c)return void H(s,"Received different permessage-deflate than the one set.");let d=o.headersList.get("Sec-WebSocket-Protocol");if(null!==d&&d!==n.headersList.get("Sec-WebSocket-Protocol"))return void H(s,"Protocol was not set in the opening handshake.");o.socket.on("data",F),o.socket.on("close",L),o.socket.on("error",A),R.open.hasSubscribers&&R.open.publish({address:o.socket.address(),protocol:d,extensions:c}),r(o)}})}};export{p as default};
//# sourceMappingURL=python-version-check.7703870e.js.map
