import e from"./python-version-check.8bf8cf5c.js";import t from"./python-version-check.789a0bf3.js";import i from"./python-version-check.54444555.js";import r from"./python-version-check.c72f9711.js";import n from"./python-version-check.e046c214.js";import{Readable as o}from"node:stream";import{inherits as a}from"node:util";var s={};let f=/^boundary$/i,c=/^form-data$/i,d=/^charset$/i,l=/^filename$/i,h=/^name$/i;function p(o,a){let s,p,_,b,y,v=this,g=a.limits,L=a.isPartAFile||((e,t,i)=>"application/octet-stream"===t||void 0!==i),H=a.parsedConType||[],k=a.defCharset||"utf8",S=a.preservePath,w={highWaterMark:a.fileHwm};for(s=0,p=H.length;s<p;++s)if(Array.isArray(H[s])&&f.test(H[s][0])){_=H[s][1];break}function A(){0===P&&z&&!o._done&&(z=!1,v.end())}if("string"!=typeof _)throw Error("Multipart: Boundary not found");let F=n(g,"fieldSize",1048576),R=n(g,"fileSize",1/0),$=n(g,"files",1/0),x=n(g,"fields",1/0),C=n(g,"parts",1/0),E=n(g,"headerPairs",2e3),j=n(g,"headerSize",81920),D=0,M=0,P=0,z=!1;this._needDrain=!1,this._pause=!1,this._cb=void 0,this._nparts=0,this._boy=o;let W={boundary:_,maxHeaderPairs:E,maxHeaderSize:j,partHwm:w.highWaterMark,highWaterMark:a.highWaterMark};this.parser=new e(W),this.parser.on("drain",function(){if(v._needDrain=!1,v._cb&&!v._pause){let e=v._cb;v._cb=void 0,e()}}).on("part",function e(n){if(++v._nparts>C)return v.parser.removeListener("part",e),v.parser.on("part",m),o.hitPartsLimit=!0,o.emit("partsLimit"),m(n);if(y){let e=y;e.emit("end"),e.removeAllListeners("end")}n.on("header",function(e){let a,f,_,g,H,C,E,j,z=0;if(e["content-type"]&&(_=t(e["content-type"][0]))[0]){for(s=0,a=_[0].toLowerCase(),p=_.length;s<p;++s)if(d.test(_[s][0])){g=_[s][1].toLowerCase();break}}if(void 0===a&&(a="text/plain"),void 0===g&&(g=k),!e["content-disposition"]||(_=t(e["content-disposition"][0]),!c.test(_[0])))return m(n);for(s=0,p=_.length;s<p;++s)h.test(_[s][0])?f=_[s][1]:l.test(_[s][0])&&(C=_[s][1],S||(C=r(C)));if(H=e["content-transfer-encoding"]?e["content-transfer-encoding"][0].toLowerCase():"7bit",L(f,a,C)){if(D===$)return o.hitFilesLimit||(o.hitFilesLimit=!0,o.emit("filesLimit")),m(n);if(++D,0===o.listenerCount("file"))return void v.parser._ignore();++P;let e=new u(w);b=e,e.on("end",function(){if(--P,v._pause=!1,A(),v._cb&&!v._needDrain){let e=v._cb;v._cb=void 0,e()}}),e._read=function(e){if(v._pause&&(v._pause=!1,v._cb&&!v._needDrain)){let e=v._cb;v._cb=void 0,e()}},o.emit("file",f,e,C,H,a),E=function(t){if((z+=t.length)>R){let i=R-z+t.length;i>0&&e.push(t.slice(0,i)),e.truncated=!0,e.bytesRead=R,n.removeAllListeners("data"),e.emit("limit");return}e.push(t)||(v._pause=!0),e.bytesRead=z},j=function(){b=void 0,e.push(null)}}else{if(M===x)return o.hitFieldsLimit||(o.hitFieldsLimit=!0,o.emit("fieldsLimit")),m(n);++M,++P;let e="",t=!1;y=n,E=function(i){if((z+=i.length)>F){let r=F-(z-i.length);e+=i.toString("binary",0,r),t=!0,n.removeAllListeners("data")}else e+=i.toString("binary")},j=function(){y=void 0,e.length&&(e=i(e,"binary",g)),o.emit("field",f,e,!1,t,H,a),--P,A()}}n._readableState.sync=!1,n.on("data",E),n.on("end",j)}).on("error",function(e){b&&b.emit("error",e)})}).on("error",function(e){o.emit("error",e)}).on("finish",function(){z=!0,A()})}function m(e){e.resume()}function u(e){o.call(this,e),this.bytesRead=0,this.truncated=!1}p.detect=/^multipart\/form-data/i,p.prototype.write=function(e,t){let i=this.parser.write(e);i&&!this._pause?t():(this._needDrain=!i,this._cb=t)},p.prototype.end=function(){let e=this;e.parser.writable?e.parser.end():e._boy._done||process.nextTick(function(){e._boy._done=!0,e._boy.emit("finish")})},a(u,o),u.prototype._read=function(e){},s=p;export{s as default};
//# sourceMappingURL=python-version-check.d76106ee.js.map
