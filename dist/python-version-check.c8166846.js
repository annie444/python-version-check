import t from"./python-version-check.ebf2a848.js";import o from"./python-version-check.c2bfca41.js";import r from"./python-version-check.91f60e5c.js";import e from"./python-version-check.8185b27f.js";import s from"./python-version-check.dba5a2d4.js";import n from"./python-version-check.091f3542.js";import{URL as i}from"url";var c={},h=t.kProxy,a=$5UmLx$pythonversioncheckebf2a848js.kClose,p=$5UmLx$pythonversioncheckebf2a848js1.kDestroy,y=$5UmLx$pythonversioncheckebf2a848js2.kInterceptors,u=$5UmLx$pythonversioncheckdba5a2d4js.InvalidArgumentError,l=s.RequestAbortedError;let f=Symbol("proxy agent"),d=Symbol("proxy client"),m=Symbol("proxy headers"),x=Symbol("request tls settings"),w=Symbol("proxy tls settings"),b=Symbol("connect endpoint function");function k(t,o){return new r(t,o)}c=class extends e{constructor(t){if(super(t),this[h]=function(t){if("string"==typeof t&&(t={uri:t}),!t||!t.uri)throw new u("Proxy opts.uri is mandatory");return{uri:t.uri,protocol:t.protocol||"https"}}(t),this[f]=new o(t),this[y]=t.interceptors&&t.interceptors.ProxyAgent&&Array.isArray(t.interceptors.ProxyAgent)?t.interceptors.ProxyAgent:[],"string"==typeof t&&(t={uri:t}),!t||!t.uri)throw new u("Proxy opts.uri is mandatory");let{clientFactory:r=k}=t;if("function"!=typeof r)throw new u("Proxy opts.clientFactory must be a function.");this[x]=t.requestTls,this[w]=t.proxyTls,this[m]=t.headers||{};let e=new i(t.uri),{origin:s,port:c,host:a,username:p,password:A}=e;if(t.auth&&t.token)throw new u("opts.auth cannot be used in combination with opts.token");t.auth?this[m]["proxy-authorization"]=`Basic ${t.auth}`:t.token?this[m]["proxy-authorization"]=t.token:p&&A&&(this[m]["proxy-authorization"]=`Basic ${Buffer.from(`${decodeURIComponent(p)}:${decodeURIComponent(A)}`).toString("base64")}`);let H=n({...t.proxyTls});this[b]=n({...t.requestTls}),this[d]=r(e,{connect:H}),this[f]=new o({...t,connect:async(t,o)=>{let r=t.host;t.port||(r+=`:${"https:"===t.protocol?443:80}`);try{let e,{socket:n,statusCode:i}=await this[d].connect({origin:s,port:c,path:r,signal:t.signal,headers:{...this[m],host:a}});if(200!==i&&(n.on("error",()=>{}).destroy(),o(new l(`Proxy response (${i}) !== 200 when HTTP Tunneling`))),"https:"!==t.protocol)return void o(null,n);e=this[x]?this[x].servername:t.servername,this[b]({...t,servername:e,httpSocket:n},o)}catch(t){o(t)}}})}dispatch(t,o){let{host:r}=new i(t.origin),e=function(t){if(Array.isArray(t)){let o={};for(let r=0;r<t.length;r+=2)o[t[r]]=t[r+1];return o}return t}(t.headers);return function(t){if(t&&Object.keys(t).find(t=>"proxy-authorization"===t.toLowerCase()))throw new u("Proxy-Authorization should be sent in ProxyAgent constructor")}(e),this[f].dispatch({...t,headers:{...e,host:r}},o)}async [a](){await this[f].close(),await this[d].close()}async [p](){await this[f].destroy(),await this[d].destroy()}};export{c as default};
//# sourceMappingURL=python-version-check.c8166846.js.map
